(function(n,t,i){n.addEventListener("DOMContentLoaded",function(){function o(){u.className="";e($canvas);n.send("S"+r({playing:!1}))}function s(){e(u);$canvas.className="";n.send("S"+r({playing:!0}))}function r(n){return n.user=t.id,n.token=t.token,JSON.stringify(n)}function e(n){n.className="x";setTimeout(function(){n.className="X"},800)}var t,f=i("#U")[0],h=i("#S")[0],u=i("form")[0],n;$canvas=i("canvas")[0];context=$canvas.getContext("2d");cellWidth=2;cellHeight=2;n=new WebSocket(location.href.replace("http","ws"));n.onclose=n.onerror=function(n){alert(n)};n.onmessage=function(n){var i=JSON.parse(n.data.substring(1,n.data.length)),r,e,u;switch(n.data.substring(0,1)){case"U":t=i;f.value=t.username;break;case"P":context.clearRect(0,0,$canvas.height,$canvas.width);for(r in i.snakes){context.fillStyle=r==t.id?"#666":"#fff";for(e in i.snakes[r])u=i.snakes[r][e],context.fillRect(u.x*cellWidth,u.y*cellHeight,cellWidth,cellHeight)}}};u.addEventListener("submit",function(i){i.preventDefault();t.username=f.value;n.send("U"+r({username:t.username}));s()});window.addEventListener("keyup",function(t){switch(t.keyCode){case 27:o();break;default:n.send("K"+r({code:t.keyCode}))}})})})(document,window,document.querySelectorAll.bind(document));