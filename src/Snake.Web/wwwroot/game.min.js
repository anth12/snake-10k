(function(n,t,i,r){n.addEventListener("DOMContentLoaded",function(){function h(){e.className="";s($canvas);t.send("S"+f({playing:!1}))}function c(){s(e);$canvas.className="";t.send("S"+f({playing:!0}))}function f(n){return n.user=u.id,n.token=u.token,JSON.stringify(n)}function s(n){n.className="x";setTimeout(function(){n.className="X"},800)}var u,o=i("#U")[0],l=i("#S")[0],e=i("form")[0],t;$canvas=i("canvas")[0];context=$canvas.getContext("2d");cellWidth=2;cellHeight=2;$canvas.width=n.width;$canvas.height=n.height;t=new WebSocket("ws://"+location.host);t.onclose=t.onerror=function(n){alert(n)};t.onmessage=function(n){var t=JSON.parse(n.data.substring(1,n.data.length)),r,e,f;switch(n.data.substring(0,1)){case"U":u=t;o.value=u.username;break;case"P":context.clearRect(0,0,$canvas.height,$canvas.width);for(r in t.snakes){context.fillStyle=r==u.id?"#666":"#fff";for(e in t.snakes[r])f=t.snakes[r][e],context.fillRect(f.x*cellWidth,f.y*cellHeight,cellWidth,cellHeight)}break;case"H":i("table")[0].innerHTML=t.html}};e[r]("submit",function(n){n.preventDefault();u.username=o.value;t.send("U"+f({username:u.username}));c()});window[r]("keyup",function(n){switch(n.keyCode){case 27:h();break;default:t.send("K"+f({code:n.keyCode}))}});window.onresize=function(){$canvas.width=n.width;$canvas.height=n.height}})})(document,window,document.querySelectorAll.bind(document),"addEventListener");