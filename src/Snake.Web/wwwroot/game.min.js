(function(n,t,i,r){n.addEventListener("DOMContentLoaded",function(){function s(){f.className="";o($canvas);n.send("S"+u({playing:!1}))}function h(){o(f);$canvas.className="";n.send("S"+u({playing:!0}))}function u(n){return n.user=t.id,n.token=t.token,JSON.stringify(n)}function o(n){n.className="x";setTimeout(function(){n.className="X"},800)}var t,e=i("#U")[0],c=i("#S")[0],f=i("form")[0],n;$canvas=i("canvas")[0];context=$canvas.getContext("2d");cellWidth=10;cellHeight=10;gameWidth=5e3;gameHeight=5e3;$canvas.height=gameHeight;$canvas.width=gameWidth;n=new WebSocket("ws://"+location.host);n.onclose=n.onerror=function(n){alert(n)};n.onmessage=function(n){var c=n.data,u=JSON.parse(c.slice(1)),f,r,h,o;switch(n.data[0]){case"U":t=u;e.value=t.username;break;case"P":context.clearRect(0,0,$canvas.width,$canvas.height);for(f in u.snakes){if(r=u.snakes[f],context.fillStyle="#9e9e9e",f==t.id){context.fillStyle="#3f51b5";var s=r[r.length-1],l=Math.floor(s.x*cellWidth/window.innerWidth),a=Math.floor(s.y*cellHeight/window.innerHeight);$canvas.style.marginTop=-window.innerHeight*a+"px";$canvas.style.marginLeft=-window.innerWidth*l+"px"}for(h in r)o=r[h],context.fillRect(o.x*cellWidth,o.y*cellHeight,cellWidth,cellHeight)}break;case"H":i("table")[0].innerHTML=u.html}};f[r]("submit",function(i){i.preventDefault();t.username=e.value;n.send("U"+u({username:t.username}));h()});window[r]("keyup",function(t){switch(t.keyCode){case 27:s();break;default:n.send("K"+u({code:t.keyCode}))}})})})(document,window,document.querySelectorAll.bind(document),"addEventListener");